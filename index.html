<!DOCTYPE html>

<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>å°è›¹çš„ Minecraft ç”Ÿå­˜å†’éšª</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; }
        body { font-family: 'Courier New', monospace; background: #1a1a2e; min-height: 100vh; overflow: hidden; }
        .game-container { width: 100vw; height: 100vh; display: flex; flex-direction: column; }

```
    .top-bar {
        background: rgba(0,0,0,0.85); padding: 8px 12px;
        display: flex; justify-content: space-between; align-items: center;
        border-bottom: 3px solid #444; flex-wrap: wrap; gap: 5px;
    }
    .stats { display: flex; gap: 12px; align-items: center; }
    .stat-row { display: flex; align-items: center; gap: 2px; }
    .stat-icon { font-size: 1rem; }
    .hearts, .foods { display: flex; gap: 1px; font-size: 0.85rem; }
    .game-info { display: flex; gap: 12px; font-size: 0.75rem; color: #aaa; align-items: center; }
    .day-badge { padding: 3px 8px; border-radius: 3px; font-weight: bold; }
    .day-badge.day { background: #f4d03f; color: #333; }
    .day-badge.night { background: #2c3e50; color: #fff; }

    .game-world { flex: 1; position: relative; overflow: hidden; background: #87CEEB; }
    .game-world.night { background: #1a1a2e; }
    .world-map { position: absolute; transition: transform 0.12s ease; }

    .tile {
        position: absolute; width: 48px; height: 48px;
        display: flex; align-items: center; justify-content: center;
        font-size: 1.6rem; cursor: pointer; transition: transform 0.08s;
        border: 1px solid rgba(0,0,0,0.1);
    }
    .tile:hover { transform: scale(1.08); z-index: 5; }
    .tile:active { transform: scale(0.95); }
    .tile.grass { background: linear-gradient(135deg, #4ade80, #22c55e); }
    .tile.dirt { background: linear-gradient(135deg, #a16207, #854d0e); }
    .tile.stone { background: linear-gradient(135deg, #9ca3af, #6b7280); }
    .tile.water { background: linear-gradient(135deg, #60a5fa, #3b82f6); cursor: not-allowed; }
    .tile.sand { background: linear-gradient(135deg, #fde047, #eab308); }
    .tile.coal-ore { background: linear-gradient(135deg, #4b5563, #374151); }
    .tile.iron-ore { background: linear-gradient(135deg, #d4d4d8, #a1a1aa); }
    .tile.gold-ore { background: linear-gradient(135deg, #fcd34d, #f59e0b); }
    .tile.diamond-ore { background: linear-gradient(135deg, #67e8f9, #22d3ee); }

    .player {
        position: absolute; width: 48px; height: 48px; font-size: 1.8rem;
        display: flex; align-items: center; justify-content: center;
        z-index: 100; filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.5));
    }

    .entity {
        position: absolute; width: 48px; height: 48px; font-size: 1.5rem;
        display: flex; align-items: center; justify-content: center;
        z-index: 50; cursor: pointer; transition: left 0.25s, top 0.25s;
    }
    .entity:hover { transform: scale(1.15); }
    .entity-hp {
        position: absolute; top: -6px; left: 50%; transform: translateX(-50%);
        background: #333; width: 36px; height: 5px; border-radius: 2px; overflow: hidden;
    }
    .entity-hp-fill { height: 100%; background: #ef4444; transition: width 0.2s; }

    .bottom-bar { background: rgba(0,0,0,0.9); padding: 8px; border-top: 3px solid #444; }

    .hotbar { display: flex; justify-content: center; gap: 3px; margin-bottom: 8px; }
    .slot {
        width: 44px; height: 44px; background: #555; border: 3px solid #333;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        font-size: 1.3rem; position: relative; cursor: pointer;
    }
    .slot.selected { border-color: #fff; box-shadow: 0 0 8px rgba(255,255,255,0.5); }
    .slot .qty {
        position: absolute; bottom: 1px; right: 3px;
        font-size: 0.55rem; color: #fff; font-weight: bold; text-shadow: 1px 1px #000;
    }

    .controls { display: flex; justify-content: space-between; align-items: center; }
    .dpad { display: grid; grid-template-columns: repeat(3, 42px); grid-template-rows: repeat(3, 42px); gap: 2px; }
    .dpad-btn {
        background: #444; border: 2px solid #666; border-radius: 4px;
        font-size: 1.1rem; color: white; cursor: pointer;
        display: flex; align-items: center; justify-content: center;
    }
    .dpad-btn:hover { background: #555; }
    .dpad-btn:active { background: #333; }
    .dpad-btn.empty { background: transparent; border: none; }

    .action-btns { display: flex; flex-direction: column; gap: 6px; }
    .act-btn {
        padding: 10px 16px; font-size: 0.8rem; font-weight: bold;
        border: 3px solid; border-radius: 6px; cursor: pointer; font-family: inherit;
    }
    .act-btn.red { background: #dc2626; border-color: #991b1b; color: white; }
    .act-btn.green { background: #16a34a; border-color: #15803d; color: white; }
    .act-btn:active { transform: scale(0.95); }

    .modal {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.92); display: none;
        align-items: center; justify-content: center; z-index: 1000;
    }
    .modal.show { display: flex; }
    .modal-box {
        background: #2d2d2d; border: 4px solid #555; padding: 18px;
        max-width: 320px; width: 90%; max-height: 75vh; overflow-y: auto;
    }
    .modal-title { font-size: 1.1rem; color: #fff; margin-bottom: 12px; text-align: center; }
    .recipe {
        background: #444; border: 2px solid #555; padding: 10px; margin-bottom: 6px;
        display: flex; align-items: center; justify-content: space-between; cursor: pointer;
    }
    .recipe:hover { background: #555; }
    .recipe.disabled { opacity: 0.4; cursor: not-allowed; }
    .recipe-info { display: flex; align-items: center; gap: 8px; }
    .recipe-icon { font-size: 1.3rem; }
    .recipe-name { color: #fff; font-size: 0.8rem; }
    .recipe-cost { color: #aaa; font-size: 0.65rem; }
    .recipe-btn { background: #16a34a; border: none; color: white; padding: 4px 10px; font-size: 0.7rem; cursor: pointer; }
    .close-btn { background: #666; border: none; color: white; padding: 10px; width: 100%; margin-top: 10px; cursor: pointer; font-family: inherit; }

    .toast {
        position: fixed; top: 70px; left: 50%; transform: translateX(-50%);
        background: rgba(0,0,0,0.85); color: #fff; padding: 8px 16px;
        border-radius: 4px; font-size: 0.8rem; z-index: 500; display: none;
    }
    .toast.show { display: block; animation: fadeToast 2s ease forwards; }
    @keyframes fadeToast {
        0% { opacity: 0; transform: translateX(-50%) translateY(-10px); }
        15%, 85% { opacity: 1; transform: translateX(-50%) translateY(0); }
        100% { opacity: 0; }
    }

    .gameover-screen {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(139,0,0,0.9); display: none;
        align-items: center; justify-content: center; flex-direction: column; z-index: 2000;
    }
    .gameover-screen.show { display: flex; }
    .gameover-screen h1 { color: #fff; font-size: 1.8rem; margin-bottom: 15px; }
    .gameover-screen p { color: #faa; margin-bottom: 20px; }
    .gameover-screen button { padding: 12px 25px; font-size: 1rem; background: #444; border: 3px solid #666; color: white; cursor: pointer; }

    .start-screen {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: linear-gradient(180deg, #87CEEB 0%, #87CEEB 55%, #22c55e 55%);
        display: flex; align-items: center; justify-content: center; flex-direction: column; z-index: 3000;
    }
    .start-screen.hidden { display: none; }
    .start-logo { font-size: 4.5rem; margin-bottom: 15px; animation: bounce 1s infinite; }
    @keyframes bounce { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    .start-title { font-size: 1.5rem; color: #fff; text-shadow: 3px 3px 0 #333; margin-bottom: 8px; text-align: center; }
    .start-sub { color: #333; margin-bottom: 25px; font-size: 0.85rem; }
    .start-btn {
        background: #4ade80; border: 4px solid #22c55e; color: #fff;
        padding: 14px 35px; font-size: 1.1rem; font-weight: bold; cursor: pointer;
        font-family: inherit; text-shadow: 1px 1px #333;
    }
    .start-btn:hover { background: #22c55e; }
    .tips { margin-top: 25px; color: #333; font-size: 0.7rem; text-align: center; line-height: 1.6; }

    @media (max-width: 400px) {
        .tile, .player, .entity { width: 40px; height: 40px; font-size: 1.3rem; }
        .slot { width: 38px; height: 38px; font-size: 1.1rem; }
        .dpad { grid-template-columns: repeat(3, 38px); grid-template-rows: repeat(3, 38px); }
    }
</style>
```

</head>
<body>
    <div class="start-screen" id="startScreen">
        <div class="start-logo">â›ï¸</div>
        <h1 class="start-title">å°è›¹çš„ Minecraft<br>ç”Ÿå­˜å†’éšª</h1>
        <p class="start-sub">æ¢ç´¢ãƒ»æ”¶é›†ãƒ»åˆæˆãƒ»ç”Ÿå­˜ï¼</p>
        <button class="start-btn" onclick="startGame()">é–‹å§‹ç”Ÿå­˜ â–¶</button>
        <div class="tips">
            ğŸ® æ–¹å‘éµ/WASD ç§»å‹•<br>
            ğŸ‘† é»åœ°åœ–æŒ–æ˜è³‡æº<br>
            âš”ï¸ é»æ€ªç‰©æˆ–æŒ‰æ”»æ“Šéµæˆ°é¬¥<br>
            ğŸ”¨ æ”¶é›†ææ–™åˆæˆå·¥å…·æ­¦å™¨
        </div>
    </div>

```
<div class="game-container">
    <div class="top-bar">
        <div class="stats">
            <div class="stat-row"><span class="stat-icon">â¤ï¸</span><div class="hearts" id="hearts"></div></div>
            <div class="stat-row"><span class="stat-icon">ğŸ–</span><div class="foods" id="foods"></div></div>
        </div>
        <div class="game-info">
            <div class="day-badge day" id="dayBadge">â˜€ï¸ ç¬¬1å¤©</div>
            <div>ğŸ’° <span id="score">0</span></div>
        </div>
    </div>

    <div class="game-world" id="gameWorld">
        <div class="world-map" id="worldMap"></div>
        <div class="player" id="player">ğŸ§‘</div>
    </div>

    <div class="bottom-bar">
        <div class="hotbar" id="hotbar"></div>
        <div class="controls">
            <div class="dpad">
                <div class="dpad-btn empty"></div>
                <div class="dpad-btn" onclick="move(0,-1)">â¬†ï¸</div>
                <div class="dpad-btn empty"></div>
                <div class="dpad-btn" onclick="move(-1,0)">â¬…ï¸</div>
                <div class="dpad-btn empty"></div>
                <div class="dpad-btn" onclick="move(1,0)">â¡ï¸</div>
                <div class="dpad-btn empty"></div>
                <div class="dpad-btn" onclick="move(0,1)">â¬‡ï¸</div>
                <div class="dpad-btn empty"></div>
            </div>
            <div class="action-btns">
                <button class="act-btn red" onclick="attackNearest()">âš”ï¸ æ”»æ“Š</button>
                <button class="act-btn green" onclick="openCraft()">ğŸ”¨ åˆæˆ</button>
            </div>
        </div>
    </div>
</div>

<div class="modal" id="craftModal">
    <div class="modal-box">
        <h2 class="modal-title">ğŸ”¨ åˆæˆå°</h2>
        <div id="recipeList"></div>
        <button class="close-btn" onclick="closeCraft()">é—œé–‰</button>
    </div>
</div>

<div class="toast" id="toast"></div>

<div class="gameover-screen" id="gameoverScreen">
    <h1>ğŸ’€ ä½ æ­»äº†</h1>
    <p id="deathMsg">è¢«æ€ªç‰©æ“Šæ•—</p>
    <button onclick="restart()">é‡æ–°é–‹å§‹</button>
</div>

<script>
    const SIZE = 25, TILE = 48;
    const ITEMS = {
        wood: { n: 'æœ¨é ­', i: 'ğŸªµ' }, stone: { n: 'çŸ³é ­', i: 'ğŸª¨' }, coal: { n: 'ç…¤ç‚­', i: 'â¬›' },
        iron: { n: 'éµç¤¦', i: 'ğŸ”©' }, gold: { n: 'é‡‘ç¤¦', i: 'ğŸ¥‡' }, diamond: { n: 'é‘½çŸ³', i: 'ğŸ’' },
        meat: { n: 'è‚‰', i: 'ğŸ–' }, apple: { n: 'è˜‹æœ', i: 'ğŸ' },
        woodSword: { n: 'æœ¨åŠ', i: 'ğŸ—¡ï¸', dmg: 3 }, stoneSword: { n: 'çŸ³åŠ', i: 'âš”ï¸', dmg: 5 },
        ironSword: { n: 'éµåŠ', i: 'ğŸ”ª', dmg: 8 }, diamondSword: { n: 'é‘½çŸ³åŠ', i: 'ğŸ’ ', dmg: 12 },
        woodPick: { n: 'æœ¨é¬', i: 'â›ï¸', pow: 1 }, stonePick: { n: 'çŸ³é¬', i: 'â›ï¸', pow: 2 },
        ironPick: { n: 'éµé¬', i: 'â›ï¸', pow: 3 },
    };
    const RECIPES = [
        { r: 'woodSword', i: 'ğŸ—¡ï¸', n: 'æœ¨åŠ', c: { wood: 3 }, d: 'æ”»æ“Š+3' },
        { r: 'woodPick', i: 'â›ï¸', n: 'æœ¨é¬', c: { wood: 5 }, d: 'æŒ–ç¤¦+1' },
        { r: 'stoneSword', i: 'âš”ï¸', n: 'çŸ³åŠ', c: { stone: 3, wood: 2 }, d: 'æ”»æ“Š+5' },
        { r: 'stonePick', i: 'â›ï¸', n: 'çŸ³é¬', c: { stone: 5, wood: 2 }, d: 'æŒ–ç¤¦+2' },
        { r: 'ironSword', i: 'ğŸ”ª', n: 'éµåŠ', c: { iron: 3, wood: 2 }, d: 'æ”»æ“Š+8' },
        { r: 'ironPick', i: 'â›ï¸', n: 'éµé¬', c: { iron: 5, wood: 2 }, d: 'æŒ–ç¤¦+3' },
        { r: 'diamondSword', i: 'ğŸ’ ', n: 'é‘½çŸ³åŠ', c: { diamond: 3, wood: 2 }, d: 'æ”»æ“Š+12' },
    ];
    const MOBS = [
        { n: 'æ®­å±', i: 'ğŸ§Ÿ', hp: 20, dmg: 2 }, { n: 'éª·é«', i: 'ğŸ’€', hp: 15, dmg: 3 },
        { n: 'èœ˜è››', i: 'ğŸ•·ï¸', hp: 12, dmg: 2 }, { n: 'è‹¦åŠ›æ€•', i: 'ğŸ’š', hp: 20, dmg: 5 },
    ];

    let G = { px: 12, py: 12, hp: 10, maxHp: 10, hunger: 10, maxHunger: 10, inv: {}, weapon: null, pick: null, day: 1, night: false, score: 0, world: [], mobs: [], running: false };

    function genWorld() {
        G.world = [];
        for (let y = 0; y < SIZE; y++) {
            G.world[y] = [];
            for (let x = 0; x < SIZE; x++) {
                let t = 'grass', obj = null, hp = 0;
                const r = Math.random();
                if (r < 0.05) t = 'water';
                else if (r < 0.1) t = 'sand';
                else if (r < 0.22) {
                    t = 'stone';
                    const o = Math.random();
                    if (o < 0.08) { t = 'diamond-ore'; hp = 5; }
                    else if (o < 0.2) { t = 'gold-ore'; hp = 4; }
                    else if (o < 0.4) { t = 'iron-ore'; hp = 3; }
                    else if (o < 0.65) { t = 'coal-ore'; hp = 2; }
                    else hp = 2;
                } else {
                    const o = Math.random();
                    if (o < 0.12) { obj = 'tree'; hp = 3; }
                    else if (o < 0.18) { obj = 'rock'; hp = 2; }
                }
                G.world[y][x] = { t, obj, hp };
            }
        }
        G.world[12][12] = { t: 'grass', obj: null, hp: 0 };
    }

    function render() {
        const map = document.getElementById('worldMap');
        map.innerHTML = '';
        map.style.width = SIZE * TILE + 'px';
        map.style.height = SIZE * TILE + 'px';
        for (let y = 0; y < SIZE; y++) {
            for (let x = 0; x < SIZE; x++) {
                const c = G.world[y][x];
                const d = document.createElement('div');
                d.className = 'tile ' + c.t;
                d.style.left = x * TILE + 'px';
                d.style.top = y * TILE + 'px';
                if (c.obj === 'tree') d.innerHTML = 'ğŸŒ²';
                else if (c.obj === 'rock') d.innerHTML = 'ğŸª¨';
                else if (c.t === 'coal-ore') d.innerHTML = 'â¬›';
                else if (c.t === 'iron-ore') d.innerHTML = 'ğŸ”©';
                else if (c.t === 'gold-ore') d.innerHTML = 'ğŸ¥‡';
                else if (c.t === 'diamond-ore') d.innerHTML = 'ğŸ’';
                else if (c.t === 'water') d.innerHTML = 'ğŸŒŠ';
                d.onclick = () => interact(x, y);
                map.appendChild(d);
            }
        }
        renderMobs();
        updateCam();
    }

    function renderMobs() {
        document.querySelectorAll('.entity').forEach(e => e.remove());
        const map = document.getElementById('worldMap');
        G.mobs.forEach((m, i) => {
            const d = document.createElement('div');
            d.className = 'entity';
            d.style.left = m.x * TILE + 'px';
            d.style.top = m.y * TILE + 'px';
            d.innerHTML = `<div class="entity-hp"><div class="entity-hp-fill" style="width:${(m.hp/m.maxHp)*100}%"></div></div>${m.i}`;
            d.onclick = () => attackMob(i);
            map.appendChild(d);
        });
    }

    function updateCam() {
        const gw = document.getElementById('gameWorld');
        const map = document.getElementById('worldMap');
        const pl = document.getElementById('player');
        const ox = gw.clientWidth / 2 - G.px * TILE - TILE / 2;
        const oy = gw.clientHeight / 2 - G.py * TILE - TILE / 2;
        map.style.transform = `translate(${ox}px,${oy}px)`;
        pl.style.left = gw.clientWidth / 2 - TILE / 2 + 'px';
        pl.style.top = gw.clientHeight / 2 - TILE / 2 + 'px';
    }

    function renderUI() {
        let h = ''; for (let i = 0; i < G.maxHp; i++) h += i < G.hp ? 'â¤ï¸' : 'ğŸ–¤';
        document.getElementById('hearts').innerHTML = h;
        let f = ''; for (let i = 0; i < G.maxHunger; i++) f += i < G.hunger ? 'ğŸ–' : 'ğŸ¦´';
        document.getElementById('foods').innerHTML = f;
        const db = document.getElementById('dayBadge');
        db.textContent = (G.night ? 'ğŸŒ™' : 'â˜€ï¸') + ` ç¬¬${G.day}å¤©`;
        db.className = 'day-badge ' + (G.night ? 'night' : 'day');
        document.getElementById('gameWorld').className = 'game-world' + (G.night ? ' night' : '');
        document.getElementById('score').textContent = G.score;
        renderHotbar();
    }

    function renderHotbar() {
        const hb = document.getElementById('hotbar');
        hb.innerHTML = '';
        const items = Object.entries(G.inv).slice(0, 9);
        for (let i = 0; i < 9; i++) {
            const s = document.createElement('div');
            s.className = 'slot';
            if (items[i]) {
                const [id, qty] = items[i];
                const it = ITEMS[id];
                if (it) {
                    s.innerHTML = it.i + (qty > 1 ? `<span class="qty">${qty}</span>` : '');
                    s.onclick = () => useItem(id);
                    if (id === G.weapon || id === G.pick) s.classList.add('selected');
                }
            }
            hb.appendChild(s);
        }
    }

    function move(dx, dy) {
        if (!G.running) return;
        const nx = G.px + dx, ny = G.py + dy;
        if (nx < 0 || nx >= SIZE || ny < 0 || ny >= SIZE) return;
        const c = G.world[ny][nx];
        if (c.t === 'water') { toast('ä¸èƒ½é€²å…¥æ°´ä¸­ï¼'); return; }
        if (c.obj) { toast('æœ‰éšœç¤™ç‰©ï¼ŒæŒ–æ‰å®ƒï¼'); return; }
        G.px = nx; G.py = ny;
        updateCam();
        if (Math.random() < 0.1) { G.hunger = Math.max(0, G.hunger - 1); if (G.hunger === 0) hurt(1, 'é¤“æ­»äº†'); renderUI(); }
        checkMobHit();
    }

    function interact(x, y) {
        if (!G.running) return;
        const dist = Math.abs(x - G.px) + Math.abs(y - G.py);
        if (dist > 2) { toast('å¤ªé äº†ï¼'); return; }
        const c = G.world[y][x];
        const pow = G.pick && ITEMS[G.pick] ? ITEMS[G.pick].pow : 1;
        if (c.obj === 'tree') {
            c.hp -= pow;
            if (c.hp <= 0) { c.obj = null; addItem('wood', 2 + Math.floor(Math.random() * 2)); if (Math.random() < 0.3) addItem('apple', 1); toast('ç²å¾—æœ¨é ­ï¼'); G.score += 5; }
            else toast(`ç æ¨¹ä¸­...(${c.hp})`);
        } else if (c.obj === 'rock' || c.t === 'stone') {
            c.hp -= pow;
            if (c.hp <= 0) { c.obj = null; if (c.t !== 'grass') c.t = 'dirt'; addItem('stone', 1 + Math.floor(Math.random() * 2)); toast('ç²å¾—çŸ³é ­ï¼'); G.score += 5; }
            else toast(`æŒ–æ˜ä¸­...(${c.hp})`);
        } else if (c.t.includes('-ore')) {
            c.hp -= pow;
            if (c.hp <= 0) {
                const ore = c.t.split('-')[0];
                c.t = 'dirt';
                if (ore === 'coal') addItem('coal', 1 + Math.floor(Math.random() * 2));
                else if (ore === 'iron') addItem('iron', 1);
                else if (ore === 'gold') addItem('gold', 1);
                else if (ore === 'diamond') addItem('diamond', 1);
                toast(`ç²å¾—${ore}ï¼`);
                G.score += ore === 'diamond' ? 50 : ore === 'gold' ? 30 : 10;
            } else toast(`æŒ–ç¤¦ä¸­...(${c.hp})`);
        }
        render(); renderUI();
    }

    function addItem(id, n = 1) { G.inv[id] = (G.inv[id] || 0) + n; renderHotbar(); }
    function removeItem(id, n = 1) { if (G.inv[id]) { G.inv[id] -= n; if (G.inv[id] <= 0) delete G.inv[id]; } renderHotbar(); }
    function hasItem(id, n = 1) { return (G.inv[id] || 0) >= n; }

    function useItem(id) {
        const it = ITEMS[id];
        if (!it) return;
        if (id === 'meat' || id === 'apple') {
            if (G.hunger < G.maxHunger) {
                G.hunger = Math.min(G.maxHunger, G.hunger + (id === 'meat' ? 4 : 2));
                removeItem(id, 1); toast(`åƒäº†${it.n}ï¼`); renderUI();
            } else toast('ä½ ä¸é¤“ï¼');
            return;
        }
        if (it.dmg) { G.weapon = id; toast(`è£å‚™${it.n}ï¼æ”»æ“Š+${it.dmg}`); renderHotbar(); return; }
        if (it.pow) { G.pick = id; toast(`è£å‚™${it.n}ï¼æŒ–ç¤¦+${it.pow}`); renderHotbar(); return; }
    }

    function openCraft() {
        const list = document.getElementById('recipeList');
        list.innerHTML = '';
        RECIPES.forEach(r => {
            const can = Object.entries(r.c).every(([i, n]) => hasItem(i, n));
            const d = document.createElement('div');
            d.className = 'recipe' + (can ? '' : ' disabled');
            const cost = Object.entries(r.c).map(([i, n]) => `${ITEMS[i].i}Ã—${n}`).join(' ');
            d.innerHTML = `<div class="recipe-info"><span class="recipe-icon">${r.i}</span><div><div class="recipe-name">${r.n}</div><div class="recipe-cost">${cost} | ${r.d}</div></div></div>${can ? '<button class="recipe-btn">åˆæˆ</button>' : ''}`;
            if (can) d.onclick = () => craft(r);
            list.appendChild(d);
        });
        document.getElementById('craftModal').classList.add('show');
    }
    function closeCraft() { document.getElementById('craftModal').classList.remove('show'); }
    function craft(r) {
        Object.entries(r.c).forEach(([i, n]) => removeItem(i, n));
        addItem(r.r, 1); toast(`åˆæˆäº†${r.n}ï¼`); G.score += 20; openCraft(); renderUI();
    }

    function spawnMob() {
        if (!G.night || G.mobs.length >= 6) return;
        if (Math.random() > 0.25) return;
        const type = MOBS[Math.floor(Math.random() * MOBS.length)];
        let x, y, tries = 0;
        do {
            x = G.px + Math.floor(Math.random() * 12) - 6;
            y = G.py + Math.floor(Math.random() * 12) - 6;
            tries++;
        } while ((x < 0 || x >= SIZE || y < 0 || y >= SIZE || G.world[y][x].t === 'water' || G.world[y][x].obj || (Math.abs(x - G.px) < 3 && Math.abs(y - G.py) < 3)) && tries < 20);
        if (tries < 20) { G.mobs.push({ ...type, x, y, maxHp: type.hp }); renderMobs(); }
    }

    function moveMobs() {
        G.mobs.forEach(m => {
            if (Math.random() < 0.5) {
                const dx = Math.sign(G.px - m.x), dy = Math.sign(G.py - m.y);
                const nx = m.x + (Math.random() < 0.5 ? dx : 0);
                const ny = m.y + (Math.random() < 0.5 ? dy : 0);
                if (nx >= 0 && nx < SIZE && ny >= 0 && ny < SIZE && G.world[ny][nx].t !== 'water' && !G.world[ny][nx].obj) { m.x = nx; m.y = ny; }
            }
        });
        renderMobs(); checkMobHit();
    }

    function checkMobHit() { G.mobs.forEach(m => { if (m.x === G.px && m.y === G.py) hurt(m.dmg, `è¢«${m.n}æ”»æ“Šäº†`); }); }

    function attackNearest() {
        if (!G.running) return;
        let hit = false;
        G.mobs.forEach((m, i) => { if (Math.abs(m.x - G.px) + Math.abs(m.y - G.py) <= 1) { attackMob(i); hit = true; } });
        if (!hit) toast('é™„è¿‘æ²’æœ‰æ€ªç‰©ï¼');
    }

    function attackMob(i) {
        const m = G.mobs[i]; if (!m) return;
        if (Math.abs(m.x - G.px) + Math.abs(m.y - G.py) > 2) { toast('å¤ªé äº†ï¼'); return; }
        const dmg = G.weapon && ITEMS[G.weapon] ? ITEMS[G.weapon].dmg : 1;
        m.hp -= dmg; toast(`å°${m.n}é€ æˆ${dmg}å‚·å®³ï¼`);
        if (m.hp <= 0) { if (Math.random() < 0.5) addItem('meat', 1); G.mobs.splice(i, 1); G.score += 30; toast(`æ“Šæ•—${m.n}ï¼`); }
        renderMobs(); renderUI();
    }

    function hurt(n, reason) { G.hp -= n; toast(`å—åˆ°${n}å‚·å®³ï¼`); renderUI(); if (G.hp <= 0) gameOver(reason); }
    function gameOver(reason) { document.getElementById('deathMsg').textContent = reason; document.getElementById('gameoverScreen').classList.add('show'); G.running = false; }
    function restart() { document.getElementById('gameoverScreen').classList.remove('show'); init(); }

    function toggleDayNight() {
        G.night = !G.night;
        if (!G.night) { G.day++; G.mobs = []; }
        renderUI(); renderMobs();
        toast(G.night ? 'å¤œæ™šä¾†è‡¨ï¼Œå°å¿ƒæ€ªç‰©ï¼' : `ç¬¬${G.day}å¤©é–‹å§‹äº†ï¼`);
    }

    function toast(msg) {
        const t = document.getElementById('toast');
        t.textContent = msg; t.classList.remove('show'); void t.offsetWidth; t.classList.add('show');
    }

    document.addEventListener('keydown', e => {
        if (e.key === 'ArrowUp' || e.key === 'w' || e.key === 'W') move(0, -1);
        else if (e.key === 'ArrowDown' || e.key === 's' || e.key === 'S') move(0, 1);
        else if (e.key === 'ArrowLeft' || e.key === 'a' || e.key === 'A') move(-1, 0);
        else if (e.key === 'ArrowRight' || e.key === 'd' || e.key === 'D') move(1, 0);
        else if (e.key === ' ') attackNearest();
        else if (e.key === 'e' || e.key === 'E') openCraft();
        else if (e.key === 'Escape') closeCraft();
    });

    function init() {
        G = { px: 12, py: 12, hp: 10, maxHp: 10, hunger: 10, maxHunger: 10, inv: { wood: 3 }, weapon: null, pick: null, day: 1, night: false, score: 0, world: [], mobs: [], running: true };
        genWorld(); render(); renderUI();
    }

    function startGame() {
        document.getElementById('startScreen').classList.add('hidden');
        init();
        toast('æ­¡è¿ï¼å…ˆæ”¶é›†æœ¨é ­è£½ä½œå·¥å…·å§ï¼');
        setInterval(() => { if (G.running) { moveMobs(); spawnMob(); } }, 1800);
        setInterval(() => { if (G.running) toggleDayNight(); }, 45000);
    }

    renderUI();
</script>
```

</body>
</html>